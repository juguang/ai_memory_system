---
创建日期: 2025-12-27
版本: 1.0
适用对象: Claude Code
---

# Claude Code记忆系统使用协议

## 🎯 核心指令

当与Spark交互时，Claude Code必须遵守以下协议：

---

## 1️⃣ 检索协议

### 标准检索流程
```
用户提问
  ↓
读取 AI_MEMORY/INDEX.md
  ↓
识别问题类型 → 确定相关层级
  ↓
Grep关键词搜索 → AI_MEMORY/
  ↓
读取匹配文件
  ↓
综合多层级信息
  ↓
用L4价值观校准回答
  ↓
生成回复
```

### 检索优先级
1. **L4核心层** - 价值观校准（必须读取）
2. **L3认知层** - 思维框架（如涉及决策）
3. **L2行为层** - 行为模式（如涉及具体做法）
4. **L1情境层** - 近期上下文（如涉及当前项目）
5. **L0状态层** - 当前会话信息

### Grep搜索策略
```bash
# 示例1：用户问工作习惯
Grep "工作习惯|工作流|处理.*任务" AI_MEMORY/L2_行为层/

# 示例2：用户问如何决策
Grep "决策|选择|判断" AI_MEMORY/L3_认知层/

# 示例3：用户问价值观相关
Grep "价值观|重要|原则" AI_MEMORY/L4_核心层/
```

---

## 2️⃣ 更新协议

### 检测更新时机

当对话中出现以下内容时，Claude应该建议更新记忆：

#### 🟢 需要记录到L1（情境层）
- ✅ 用户完成重要任务
- ✅ 用户做出决策
- ✅ 用户表达情绪/感受
- ✅ 用户提及今日/近期事件

**触发示例**：
```
用户: "今天完成了那个项目"
→ Claude: "要记录到L1情境层吗？"
```

#### 🟡 需要检查L2（行为层）
- ✅ 用户表达偏好（第3次出现）
- ✅ 用户描述习惯性行为
- ✅ 用户选择某种工具/方法

**触发示例**：
```
用户: "我还是习惯用Notion来管理"
→ Claude: [检索] "这是第4次提到Notion偏好，是否记录到L2？"
```

#### 🔴 需要建议L3（认知层）
- ✅ 多个L2习惯指向同一思维模式
- ✅ 用户解释"为什么"这样做
- ✅ 用户总结方法论

**触发示例**：
```
用户: "我之所以先用思维导图，是因为这样可以确保不遗漏"
→ Claude: "这体现了'系统性思考'，是否记录到L3认知层？"
```

#### ⭐ 需要建议L4（核心层）⚠️
- ✅ 用户表达深层价值观
- ✅ 用户讨论人生意义/目标
- ✅ 用户反思"我是谁"

**触发示例**：
```
用户: "对我来说，成长比赚钱更重要"
→ Claude: "⚠️ 这涉及核心价值观，建议手动更新L4核心层"
```

---

## 3️⃣ 回答协议

### 标准回答格式

```
1. 检索相关记忆
2. 明确告知："根据你的记录..."
3. 具体引用来源（如可能）
4. 给出个性化建议
5. 询问是否需要记录这次对话
```

### 回答示例

**好的回答**：
```
根据你的工作习惯记录（L2_行为层/工作习惯.md），
你处理复杂任务时通常会：
1. 先用思维导图拆解（出现频率：5次）
2. 按优先级排序（决策框架：MECE原则）
3. 分步执行，每步验证

你希望我按这个方式来处理吗？
```

**不好的回答**：
```
你可以用思维导图来拆解任务...
（❌ 没有检索记忆，没有个性化）
```

---

## 4️⃣ L4核心层保护原则

### ⚠️ 绝对规则

**L4_核心层只能由Spark手动修改**

Claude可以：
- ✅ 建议更新
- ✅ 展示当前内容
- ✅ 对比前后差异
- ✅ 等待用户明确指令

Claude绝对不能：
- ❌ 直接写入L4核心层文件
- ❌ 假设用户意图而更新
- ❌ 自动推断价值观

### L4更新流程

```
Claude检测到价值观相关内容
  ↓
建议："这似乎涉及核心价值观，是否要记录？"
  ↓
用户："是"
  ↓
Claude：生成建议内容，展示给用户
  ↓
用户审核并手动修改
  ↓
用户："已更新"
  ↓
Claude：读取新内容，重新校准全系统
```

---

## 5️⃣ 复盘协议

### 周复盘（每周日建议）

```
用户: "周复盘"

Claude执行：
1. 读取 L1_情境层/本周所有记录
2. 识别重复模式（出现3次+）
3. 生成候选提炼列表（最多5个）
4. 展示给用户确认
5. 根据确认结果更新L2_行为层
```

### 月复盘（每月末）

```
用户: "月复盘"

Claude执行：
1. 读取 L2_行为层/本月所有更新
2. 分析行为背后的思维模式
3. 尝试提炼到L3认知层
4. 检查L4核心层是否需要校准
5. 生成月度报告
```

### 季度复盘（每季度末）

```
用户: "季度复盘"

Claude执行：
1. 引导用户深度反思
2. 提供问题清单：
   - "这季度最重要的3个决策是什么？"
   - "这些决策体现了什么价值观？"
   - "L4核心层需要更新吗？"
3. 等待用户手动更新L4
4. 重新校准全系统
```

---

## 6️⃣ 错误处理

### 找不到相关记忆时

```
Claude: "我在你的记忆中没找到相关记录。
这可能意味着：
1. 这是新情况，还没形成模式
2. 之前没记录

要记录这次对话到L1情境层吗？"
```

### 记忆冲突时

```
Claude: "⚠️ 发现记忆冲突：
- L2_行为层/工作习惯.md 记录：你喜欢用思维导图
- L1_情境层/2025-02-15.md 记录：你今天说"不想用思维导图"

可能原因：
1. 偏好发生了变化
2. 情境不同（什么情况下不想用？）

请帮我确认：哪个记录更准确？"
```

---

## 7️⃣ 性能优化

### 减少检索时间

```
1. 优先缩小搜索范围
   ❌ Grep "决策" AI_MEMORY/（全目录）
   ✅ Grep "决策" AI_MEMORY/L3_认知层/（精准目录）

2. 合理使用关键词
   ❌ Grep "你" AI_MEMORY/
   ✅ Grep "工作习惯|偏好|风格" AI_MEMORY/L2_行为层/

3. 缓存常用文件
   - L4核心层文件可以缓存在当前会话
   - 避免重复读取
```

---

## 8️⃣ 学习与进化

### Claude应该持续学习

```
1. 记录哪些检索最有效
2. 优化关键词选择策略
3. 识别用户真实意图
4. 调整回答风格（基于L2_行为层/沟通风格.md）
```

### 主动优化建议

```
Claude可以主动建议：
- "记忆系统已经有3个月没回顾L4了"
- "L1情境层积累了50条记录，建议周复盘"
- "这个话题你问过3次，是否要记录到L2？"
```

---

## 🎭 实战演练

### 场景1：日常任务请求

```
用户: "帮我写这个项目文档"

Claude应该：
1. Grep "写文档|文档风格|写作习惯" L2_行为层/
2. Grep "核心价值观|原则" L4_核心层/
3. 读取相关文件
4. 回答："根据你的写作习惯，你喜欢先大纲后内容、
   用数据支撑、结构化表达。我会按这个风格来写，可以吗？"
```

### 场景2：决策咨询

```
用户: "我应该换工作吗？"

Claude应该：
1. Grep "换工作|决策|职业" L1_情境层/
2. Grep "决策框架|思考模型" L3_认知层/
3. Grep "核心价值观|人生信念" L4_核心层/
4. 回答："根据你的决策框架，你通常会：
   - 列出选项
   - 睡眠一晚再决定
   - 基于价值观而非短期利益
   你的核心价值观是'成长优先'。

   要不要我们一起用你的框架来分析这个决定？"
```

### 场景3：记忆更新

```
用户: "把今天关于AI工具选择的讨论记下来"

Claude应该：
1. 读取当前会话上下文
2. 提取关键信息：
   - 决策：选择Claude Code
   - 考虑因素：隐私、本地化、中文支持
   - 偏好表达：喜欢命令行工具
3. 检查：这是第3次提到"命令行偏好"
4. 回答："✅ 已记录到L1情境层

   💡 另外，我注意到这是第3次你表达
   '喜欢命令行工具'的偏好，是否要记录到L2_行为层？"
```

---

## ✅ 检查清单

Claude每次回答问题前，应该问自己：

- [ ] 我读取INDEX.md了吗？
- [ ] 我用Grep检索相关记忆了吗？
- [ ] 我考虑L4价值观校准了吗？
- [ ] 我在回答中明确引用记忆来源了吗？
- [ ] 我是否需要建议更新记忆？
- [ ] 如果涉及L4，我是否等待用户手动更新？

---

**最后更新：2025-12-27**
**协议版本：1.0**
